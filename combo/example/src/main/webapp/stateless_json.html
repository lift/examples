<!DOCTYPE html>
<html>

<head>
  <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
  <title>Template</title>
</head>

<body data-lift-content-id="main">

  <div id="main" data-lift="surround?with=default2;at=content">

    <h2>Stateless JSON Sample</h2>
    <nav aria-label="breadcrumb" role="navigation">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="index.html">Home</a>
        </li>
        <li class="breadcrumb-item">
          <a href="interactive.html">Interactive Stuff</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">Stateless JSON Sample</li>
      </ol>
    </nav>

    <div class="form-group">
      <textarea id="json_question" class="form-control" rows="8"></textarea>
    </div>
    <div class="form-group">
      <select id="json_select" class="form-control">
        <option value="show">Show</option>
        <option value="textile">Show in Textile</option>
        <option value="count">Count Characters</option>
        <option value="error">Show an error</option>
      </select>
    </div>
    <button onclick="jQuery.ajax({ url : 'stateless_json_call', data : JSON.stringify({'command': document.getElementById('json_select').value, 'params':document.getElementById('json_question').value}), type : 'POST', dataType : 'script', contentType: 'text/json', timeout : 5000, cache : false});"
      class="btn btn-primary">Click Me</button>
    <div id="json_result"></div>

    <hr>

    <span class="badge badge-secondary">The Scala Code</span>
    <pre><code class="scala">object StatelessJson {
  def init() {
    // register the JSON handler
    LiftRules.statelessDispatch.append {
      case r @ Req("stateless_json_call" :: Nil, _, PostRequest) =>
        () =>
          handleJson(r)
    }
  }

  implicit def iterableToBox[X](in: Iterable[X]): Box[X] =
    in.toList.headOption

  def handleJson(req: Req): Box[LiftResponse] =
    for {
      json <- req.json // get the JSON
      JObject(
        List(JField("command", JString(cmd)),
             JField("params", JString(params)))) <- json // extract the command
    } yield
      JavaScriptResponse(
        SetHtml(
          "json_result",
          cmd match { // build the response
            case "show"    => Text(params)
            case "textile" => TextileParser.toHtml(params, Empty)
            case "count"   => Text(params.length + " Characters")
            case x         => &lt;b&gt;Problem... didn't handle JSON message {x}&lt;/b&gt;
          }
        ))
}</code></pre>
  </div>
</body>

</html>