<!DOCTYPE html>
<html>

<head>
  <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
  <title>Template</title>
</head>

<body data-lift-content-id="main">
  <div id="main" data-lift="surround?with=default2;at=content">
    <h2>Wiring Invoice</h2>
    <nav aria-label="breadcrumb" role="navigation">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="index.html">Home</a>
        </li>
        <li class="breadcrumb-item">
          <a href="misc.html">Misc code</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">Wiring Invoice</li>
      </ol>
    </nav>

    <div>
      An example of using Lift's Wiring feature to build an invoice system.
    </div>

    <form class="form-inline" id="invoice_lines" data-lift="InvoiceWiring.showLines">input goes here</form>

    <div class="form-group row">
      <div class="col-sm-2">
        <div data-lift="InvoiceWiring.addLine?div=invoice_lines">Add</div>
      </div>
    </div>

    <div class="form-group row">
      <label class="col-3">Subtotal:</label>
      <div class="col-2">
        <span data-lift="InvoiceWiring.subtotal">subtotal</span>
      </div>
    </div>

    <div class="form-group row">
      <label class="col-sm-3 col-form-label">Tax Rate:</label>
      <div class="col-sm-2">
        <input data-lift="InvoiceWiring.taxRate">
      </div>
    </div>

    <div class="form-group row">
      <label class="col-3">Taxable:</label>
      <div class="col-2">
        <span data-lift="InvoiceWiring.taxable">taxable</span>
      </div>
    </div>

    <div class="form-group row">
      <label class="col-3">Tax:</label>
      <div class="col-2">
        <span data-lift="InvoiceWiring.tax">Tax</span>
      </div>
    </div>

    <div class="form-group row">
      <label class="col-3">Total:</label>
      <div class="col-2">
        <span data-lift="InvoiceWiring.total">Total</span>
      </div>
    </div>

    <hr>

    <div>
      The code for managing the invoice page is very simple. We define the relationship between the data:
    </div>

    <pre><code class="scala">case class Line(guid: String, name: String, price: Double, taxable: Boolean)

  private object Info {
    val invoices = ValueCell(List(newLine))
    val taxRate = ValueCell(0.05d)
    val subtotal = invoices.lift(_.foldLeft(0d)(_ + _.price))
    val taxable = invoices.lift(_.filter(_.taxable).foldLeft(0D)(_ + _.price))

    val tax = taxRate.lift(taxable) { _ * _ }

    val total = subtotal.lift(tax) { _ + _ }
  }</code></pre>

    <div>
      Next we create snippets to display the data:
    </div>
    <pre><code class="scala">  def subtotal(in: NodeSeq) = WiringUI.asText(in, Info.subtotal)

  def taxable(in: NodeSeq) = WiringUI.asText(in, Info.taxable)

  def tax(in: NodeSeq) = WiringUI.asText(in, Info.tax, JqWiringSupport.fade)

  def total(in: NodeSeq) = WiringUI.asText(in, Info.total, JqWiringSupport.fade)</code></pre>

    <div>
      And hook the snippets into our view:
    </div>
    <pre><code class="html">  &lt;div class="form-group row"&gt;
    &lt;label class="col-3"&gt;Subtotal:&lt;/label&gt;
    &lt;div class="col-2"&gt;
      &lt;span data-lift="InvoiceWiring.subtotal"&gt;subtotal&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;div class="form-group row"&gt;
    &lt;label class="col-sm-3 col-form-label"&gt;Tax Rate:&lt;/label&gt;
    &lt;div class="col-sm-2"&gt;
      &lt;input data-lift="InvoiceWiring.taxRate"&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;div class="form-group row"&gt;
    &lt;label class="col-3"&gt;Taxable:&lt;/label&gt;
    &lt;div class="col-2"&gt;
      &lt;span data-lift="InvoiceWiring.taxable"&gt;taxable&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;div class="form-group row"&gt;
    &lt;label class="col-3"&gt;Tax:&lt;/label&gt;
    &lt;div class="col-2"&gt;
      &lt;span data-lift="InvoiceWiring.tax"&gt;Tax&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;div class="form-group row"&gt;
    &lt;label class="col-3"&gt;Total:&lt;/label&gt;
    &lt;div class="col-2"&gt;
      &lt;span data-lift="InvoiceWiring.total"&gt;Total&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;</code></pre>

    <div>
      And each time any of the cells changes, the display is automatically updated.
    </div>

  </div>
</body>

</html>